---
title: "Shapley values"
subtitle: "eXplainable AI"
author: "Mateusz Cedro"
date: "Machine Learning @ MIMUW 2022"
format:
  revealjs: 
    theme: [default]
    slide-number: true
    touch: true
    scrollable: true
    chalkboard: 
      buttons: false
    logo: images/XAI.png
    footer: "eXplainable AI -- Shapley values -- MIM UW -- 2022"
---
<p><img src="images/shap_v_01.png" width="100%"/></p>

# Paper of the day

```{css, echo=FALSE}
.reveal {
  font-size: 24px;
  line-height: 1.6!important;
}
code {
  font-size: 18px!important;
  line-height: 1.2!important;
}
pre {
  line-height: 1.2!important;
}



## A Unified Approach to Interpreting Model Predictions

- In this course, you will learn about the main methods and tools related to XAI, but also (and this may be unique) about selected papers and researchers.
- That's why we will start this and the next classes with a brief presentation of a high-impact article from the XAI field + few words about the author of this article.
- Today we are talking about Shapley values, so the article of the day will be the 2017 SHAP method article.
- It will be about the paper [A Unified Approach to Interpreting Model Predictions](https://papers.nips.cc/paper/2017/hash/8a20a8621978632d76c43dfd28b67767-Abstract.html)

<p><img src="images/shap_v_01.png" width="100%"/></p>


## SHAP paper in numbers

- This article is really exceptional, it will soon exceed 10,000 citations which is an amazing achievement.
- The article has several strong points, which we will talk about later today, one of which is the available software that allows you to easily use the described method
- This software is a shap library, which on GitHub has skyrocketing numbers of stars and downloads

<p><img src="images/shap_v_01.png" width="100%"/></p>

<p><img src="images/shap_v_01.png" width="100%"/></p>


## Why SHAP?

- Shapley values are currently the most popular technique for model explanations (almost in each category: local, global, model agnostic, model specific...)
- if you remember only one method after this course, let it be the SHAP
- It has more than five years of development. In the list of major XAI methods, you can also find its various extensions like ShapleyFlow or ASV (more about them later)
- figures below are from the paper [Explainable AI Methods - A Brief Overview](https://link.springer.com/chapter/10.1007/978-3-031-04083-2_2)

<p><img src="images/shap_v_01.png" width="100%"/></p>

<p><img src="images/shap_v_01.png" width="100%"/></p>




## XAI pyramid

- We will use an XAI pyramid to present new methods during this course. 
- Today we will mainly talk about the method of local explanations - Shapley values, which for a single observation determines the importance of variables.

<p><img src="images/shap_v_01.png" width="100%"/></p>

- This is one of the three fundamental methods of explaining the behaviour of predictive models.
- The following three panels introduce these three concepts; we will return to them in one week and two weeks.
- SHAP corresponds to panel C. We try to explain the behaviour of the model by decomposing the distance between this particular prediction and the average prediction of the model.

<p><img src="images/shap_v_01.png" width="100%"/></p>



# Shapley values


## Notation

- We have set of $P = \{1, ..., p\}$ players
- For each coalition, i.e. subset $S	\subseteq P$ we can calculate the payout $v(S)$ and $v(\{\varnothing\}) = 0$
- We want to fairly distribute the payout $v(P)$
- Optimal attribution for player $i\in P$ will be denoted as $\phi_i$ 

## Motivational example 1/3

How to divide the reward?

- Three parties A, B and C took part in the election. 
- As a result of the election, parties A and B each have 49% representation in the parliament and party C has 2% representation. 
- Let's assume that A and C formed a government. 
- How to fairly divide the prize (ministries)? 
- What share of the prize should party C have?


Note that any two parties can form a government.  In that case, should the prize for C be equal to or less than that for A?

<p><img src="images/shap_v_01.png" width="100%"/></p>

